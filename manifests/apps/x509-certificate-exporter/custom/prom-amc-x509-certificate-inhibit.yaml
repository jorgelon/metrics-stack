apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: x509-certificate-inhibit
spec:
  inhibitRules:
    # When CertificateExpiration fires, suppress CertificateRenewal for same cert
    - sourceMatch:
        - name: alertname
          value: CertificateExpiration
      targetMatch:
        - name: alertname
          value: CertificateRenewal
      equal:
        - subject_CN
        - filepath
        - secret_name
        - secret_namespace
    # When multiple CertificateRenewal alerts exist for same subject_CN, keep only one
    - sourceMatch:
        - name: alertname
          value: CertificateRenewal
      targetMatch:
        - name: alertname
          value: CertificateRenewal
      equal:
        - subject_CN
